## MakePl
MakePl是什么？可以理解成情侣之间的todolist，其实灵感主要来自于生活中的痛点。在设计这个app的系统功能时候，我考虑的是什么呢。

首先应该对系统总的角色做一个细分，觉得分类大概如下，

- 用户
- 项目
- 日程
- 任务
- 子任务
- 收藏
- 备注
- 上附件
	- 图片
	- 文本
- 评论
- 聊天
- 通知

当然一开始规划了这么大的系统，实现起来确实繁杂，在此必须要对这个系统进行精简，在项目的开始阶段，保留主要精力来实现主要功能，所以对上述所列进行删减，保留如下内容，

- 用户
- 项目
- 任务
	- 收藏
	- 附件
	- 备注
	- 重复
- 通知


	
## 模型设计

### User模型
在MakePl系统中，最重要的角色就是用户角色，所有的项目Project和任务都是围绕着用户来进行的，用户User包括如下属性，

- userId
- username
- password
- nickname
- avatar
- address
- birthday
- gender
- qqOpenId
- wechatOpenId
- weiboOpenId

用户有如下的基本行为，

- 注册
- 登录
- 登出

### Project模型
Project在MakePl中代表项目的意思，项目就像是任务的文件夹，对相关任务进行归纳和整理的作用，它有如下属性，
- projectId
- name
- thumbnail
- color
- expireMissionCount
- totalMissionCount
- superProject
- subProjects
- hasShare
- members
- isEmpty（待定）

这里，有几个属性需要特别注明一下，`color`表示项目的颜色，表示了任务的重要性和级别；hasShare是该任务是否与其他人分享了，在MakePl系统中尽量表示用户是否与另一方分享；members表示参与该项目的人，在MakePl系统中，最多只会有两个参与的人，因为它是恋人todo list应用程序嘛。默认情况，project的members只包含用户自己，如果包含了对方，则hasShare属性则被设置为YES值。

### Mission模型

Mission是Project项目文件夹中的具体的一个任务，它包含如下属性，

- title
- dateline
- remindDate
- superProject
- subMissions
- isCollect
- priority 优先级
- remark 备注
- comments
- files
- tags 标签


## 页面设计
经过上面的精简之后，页面设计也会简化很多，初步设想是使用TabBar的形式，下面分为3个TabBar，

- 首页
	- 个人项目列表
		- 收件箱
		- 今天
		- 本周
		- 电影
		- 杂项
		- 履行
		- 读书
		- 纪念日
		- ......
	- 添加新的项目
	- 左侧“搜索”按钮
	- 右侧“扫码”按钮
- 创建
	- 创建新的项目
	- 创建新的任务
	- 创建新的文件
- 我的
	- 个人设置
	- 消息中心
		- 到期任务的提示
	- 近期任务
	- 任务汇总
	- 收藏的任务
- 消息中心
	- 消息盒子
	- 聊天页面
	
### 用户登录/注册逻辑
系统中，用户的角色是第一位的，所有的业务和逻辑都是基于用户来维持的。登录和注册作为吸收用户的一个入口，这一块的逻辑应该好好整理。


用户注册，什么样的信息最重要呢？笔者认为，在当前，手机号和微信是一等的选择，因为每个人都有手机，每个人都有微信，这无疑为用户登录和注册提供了方便。
So，在设计用户注册和登录页面时，应该以手机号和微信为核心。

在MakePl系统中，一方面用户可以无需注册、直接使用微信登录；另一方面，用户可通过手机号码注册账户，使用手机号直接登录系统。如果通过手机号注册的用户忘记了密码，可在忘记密码的页面，通过发送短信到手机重置密码。

另外，在设计初期，笔者想使用邮箱号来作为用户注册的首选，但是考虑到邮箱并没有手机号普及程度大，所以暂时放弃了使用邮箱号注册、登陆的选择。后面随着系统完善，考虑为用户开放邮箱注册、登录以及绑定账户的功能。

### 首页的项目列表

项目列表包含了三个系统默认的项目，分别是，
- 今天
- 收件箱
- 本周
这3个默认的项目，用户和系统都不能删除，算是常驻系统的项目。

除了上述3个默认的项目，用户还可以手动添加自己的项目，添加的方式是滑动到列表底部，点击列表的最后一个cell，当然最后一个cell会做的非常明显，这样做事为了为了明确告知用户添加新项目的方式。对于用户新增的项目，用户也可以通过左滑和编辑页面，来删除该项目；如果用户删除了新增的项目，则该项目中扥所有任务也一并删除了。

为了区分系统项目和自定义新增项目，在列表中通过分区的方式将两块内容相隔开来，这样对于用户来说更加容易区分。

项目列表的数据来源分为两部分，
- 数据库
- leancloud网络
对于系统默认的3个项目 - 收件箱、今天和本周，它们是用户不能删除的，存储在数据库，用户无需网络即可访问；而用户新增的个人项目，则会同步到leancloud网络，同时也会在本地数据库缓存一份。所以项目列表加载数据的规则就是从数据库加载系统默认的项目，从网络加载用户个人新增的项目；如果网络异常，加载个人项目失败，则加载缓存本地数据库的个人项目。

上面的加载方式可能会存在一个问题，那就是系统项目里面的任务也是需要上传到网络，那么则需要为这些任务指定对应的父项，而系统项目如果缓存在本地，则不可能有对应的objectId，所以还是应该将父项同步一份到网络，但是仅仅需要同步一次。同步的规则是，App首次启动的时候，判断数据库中是否有默认的父项，如果没有父项则创建3个默认的父项，同步到服务器并缓存在数据库；如果在数据库中加载到系统默认的父项，则不再到网络请求默认父项内容。
